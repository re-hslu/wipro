\subsection{CampusRoomSearch}

Das CampusRoomSearch Feature ermöglicht es Benutzern, Räume auf dem Campus zu suchen und zu finden. 
Es stellt interaktive PDF-Karten bereit, die Campus-Übersichten und Gebäudepläne enthalten, und ermöglicht es Benutzern, 
durch Klicken auf annotierte Bereiche in den PDFs zu navigieren und detaillierte Informationen zu Räumen, Gebäuden und Etagen abzurufen. 

\vspace{0.5cm}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{Fotos/feature-screenshots/campusroomsearch_diagramm.png}
    \caption{Ablaufdiagramm}
    \label{fig:campusroomsearch_diagramm}
\end{figure}

\subsubsection*{Ziel und Motivation}

Das Hauptziel des CampusRoomSearch Features besteht darin, Studierenden und Mitarbeitenden eine intuitive Möglichkeit zu bieten, 
Räume auf dem Campus zu finden. Durch die Verwendung von interaktiven PDF-Karten mit Annotationen können Benutzer direkt auf Bereiche in den Karten klicken, 
um zu detaillierten Gebäude- und Etagenplänen zu navigieren. Dies bietet eine benutzerfreundliche Alternative zu textbasierten Suchfunktionen.

Ein weiteres wichtiges Ziel ist die Offline-Funktionalität. Da Campus-Pläne und Gebäudekarten häufig benötigt werden, 
werden alle PDF-Dateien lokal gespeichert, sodass das Feature auch ohne aktive Netzwerkverbindung vollständig funktionsfähig ist. 
Die Synchronisation erfolgt intelligent basierend auf Timestamp-Vergleichen, um unnötige Downloads zu vermeiden.

\subsubsection*{Umsetzung / Funktionsweise}

Die Implementierung basiert auf einer zweistufigen Architektur: \texttt{CampusRoomSearchModuleLoader} lädt die Liste der verfügbaren Campus-Standorte, 
während \texttt{CampusRoomSearchDataLoader} die detaillierten Daten für einen spezifischen Campus-Standort lädt, 
einschliesslich aller PDF-Dateien.

Der \texttt{CampusRoomSearchModuleLoader} erbt von \texttt{CommonApplicationBaseModuleLoader} und erweitert die Standard-Funktionalität, 
um nach dem Laden der Campus-Liste automatisch die detaillierten Daten für alle Items zu laden.

Die \texttt{loadRemoteDetailedData()}-Methode lädt die detaillierten Campus-Daten von der API und lädt anschliessend alle zugehörigen PDF-Dateien herunter.

Die \texttt{PDFRoomSearchView} Komponente rendert PDF-Dateien mit Android's \texttt{PdfRenderer} und unterstützt interaktive Annotationen. Die Komponente lädt PDFs aus der Room-Datenbank und ermöglicht Zoom- und Pan-Gesten:

\begin{lstlisting}[language=Kotlin, caption={Beispiel PDFRoomSearchView}]
@Composable
fun PDFRoomSearchView(
    pdfData: ByteArray,
    annotations: List<Annotation>,
    onAnnotationClick: (Annotation) -> Unit
) {
    // PDF-Rendering mit PdfRenderer
}
\end{lstlisting}

Die Annotation-Erkennung funktioniert durch Koordinaten-Transformation. Wenn ein Benutzer auf das PDF klickt, 
werden die Tap-Koordinaten basierend auf dem aktuellen Zoom- und Pan-Zustand transformiert, um die entsprechende Annotation zu finden:

\begin{lstlisting}[language=Kotlin, caption={Beispiel transformTapCoordinates}]
fun transformTapCoordinates(
    tapX: Float, tapY: Float,
    zoom: Float, panX: Float, panY: Float
): Pair<Float, Float> {
    return ((tapX - panX) / zoom, (tapY - panY) / zoom)
}
\end{lstlisting}

Der \texttt{RoomsearchViewModel} verwaltet die Suche nach Räumen und die Interaktion mit den SVG-Karten. 
Er verwendet JavaScript-Interfaces, um Kommunikation zwischen WebView und Android-Code zu ermöglichen:

\begin{lstlisting}[language=Kotlin, caption={Beispiel IJavascriptHandler}]
interface IJavascriptHandler {
    @JavascriptInterface
    fun onBuildingClick(buildingId: String)
}
\end{lstlisting}

\subsubsection*{Weitere Informationen}

\begin{table}[H]
\centering
\begin{tabularx}{\textwidth}{|l|X|}
\hline
\textbf{Funktionalität} & \textbf{Beschreibung} \\
\hline
\textbf{PDF-Annotationen} & 
Die PDF-Annotationen werden aus den PDF-Metadaten extrahiert und als unsichtbare, aber klickbare Bereiche über dem PDF gerendert. 
Dies ermöglicht eine präzise Interaktion, während das ursprüngliche PDF-Layout erhalten bleibt. Die Koordinaten-Transformation berücksichtigt Zoom- und Pan-Zustände für eine genaue Erkennung. \\
\hline
\textbf{Hierarchische Navigation} & 
Das Feature unterstützt mehrere Campus-Standorte, wobei jeder Standort seine eigenen Gebäude, Etagen und Räume hat. 
Die Navigation erfolgt hierarchisch: Campus → Gebäude → Etage → Raum, wobei jede Ebene durch entsprechende PDF-Karten und Annotationen dargestellt wird. \\
\hline
\textbf{WebView-Integration} & 
Die WebView-Integration für SVG-Karten ermöglicht interaktive Gebäudekarten, bei denen Benutzer auf Gebäude klicken können, um direkt zu den entsprechenden Etagenplänen zu navigieren. 
Die JavaScript-Interface-Implementierung ermöglicht eine bidirektionale Kommunikation zwischen der WebView und dem Android-Code. \\
\hline
\textbf{PDF-Rendering} & 
Die PDF-Dateien werden mit Android's \texttt{PdfRenderer} gerendert und unterstützen Zoom- und Pan-Gesten. 
Die Komponente lädt PDFs aus der Room-Datenbank und ermöglicht eine flüssige Interaktion mit den Karten. \\
\hline
\end{tabularx}
\caption{Wichtigste Funktionalitäten des \texttt{CampusRoomSearch} Features}
\label{tab:campusroomsearch-features}
\end{table}
